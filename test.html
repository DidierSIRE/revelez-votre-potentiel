<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Mini Test DISC & Valeurs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f7f9fa;
      color: #222;
      margin: 0;
      padding: 2rem;
    }
    h1 {
      text-align: center;
      color: #2E7D32;
      margin-bottom: 0.3rem;
    }
    h2 {
      text-align: center;
      font-size: 1rem;
      color: #444;
      margin-top: 0;
      margin-bottom: 2rem;
    }
    #question-container, #contactForm, #confirmation {
      max-width: 700px;
      margin: auto;
      background: #fff;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 2rem;
    }
    .question-block {
      display: none;
      transition: transform 0.5s ease-in-out, opacity 0.3s ease-in-out;
    }
    .question-block.show {
      display: block;
      opacity: 1;
      transform: translateX(0);
    }
    .question-block.exit {
      transform: translateX(200%);
      opacity: 0;
    }
    label {
      display: block;
      margin: 0.5rem 0;
    }
    button {
      padding: 0.8rem 1.2rem;
      font-size: 1rem;
      border-radius: 6px;
      cursor: pointer;
      display: block;
      margin: 2rem auto 0;
    }
    #validateBtn:disabled {
      background-color: #ccc;
      color: #666;
      border: none;
    }
    #validateBtn:enabled {
      background-color: #FFA726;
      color: white;
      border: none;
    }
    input[type="text"], input[type="email"] {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.3rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }
  </style>
</head>
<body>

<h1>Mini Test DISC & Valeurs</h1>
<h2>(Sélectionnez spontanément une seule réponse à 10 questions – c’est rapide !)</h2>

<div id="question-container"></div>

<button id="validateBtn" disabled>Valider mes réponses</button>

<form id="contactForm" style="display:none;">
  <label for="prenom">Prénom :</label>
  <input type="text" id="prenom" name="prenom" required>

  <label for="nom">Nom :</label>
  <input type="text" id="nom" name="nom" required>

  <label for="email">Adresse email :</label>
  <input type="email" id="email" name="email" required>

  <button type="submit">Envoyer</button>
</form>

<div id="confirmation" style="display:none;">
  <p>Merci ! Vous recevrez votre mini rapport personnalisé dans un délai de 24h.</p>
</div>

<script>
  const questions = [
    {
      question: "Quand un projet démarre, je suis plutôt du genre à :",
      options: [
        { text: "M'assurer que tout est clair et structuré", style: "C" },
        { text: "Motiver les autres avec enthousiasme", style: "I" },
        { text: "Prendre les choses en main immédiatement", style: "D" },
        { text: "M'assurer que tout le monde est à l’aise avec le changement", style: "S" }
      ]
    },
    {
      question: "Dans une discussion tendue, je :",
      options: [
        { text: "Essaye de comprendre les ressentis des autres", style: "S" },
        { text: "Donne mon point de vue de façon directe", style: "D" },
        { text: "Cherche à calmer le jeu et rassurer", style: "I" },
        { text: "Me réfère aux faits pour être le plus juste possible", style: "C" }
      ]
    },
    {
      question: "En groupe, on me reconnaît souvent pour :",
      options: [
        { text: "Ma fiabilité et mon côté rassurant", style: "S" },
        { text: "Mon énergie communicative", style: "I" },
        { text: "Mon exigence et mon goût du travail bien fait", style: "C" },
        { text: "Mon esprit de décision et ma capacité à trancher", style: "D" }
      ]
    },
    {
      question: "Quand je suis en désaccord, j’ai tendance à :",
      options: [
        { text: "Argumenter calmement sans chercher à dominer", style: "S" },
        { text: "Exiger des preuves ou des justifications solides", style: "C" },
        { text: "Imposer mon point de vue", style: "D" },
        { text: "Essayer de garder une bonne ambiance", style: "I" }
      ]
    },
    {
      question: "Je préfère travailler dans un environnement où :",
      options: [
        { text: "Les procédures sont claires et respectées", style: "C" },
        { text: "Je peux influencer et inspirer les autres", style: "I" },
        { text: "Je peux progresser rapidement et prendre des décisions", style: "D" },
        { text: "L’ambiance est stable et sans tension", style: "S" }
      ]
    },
    {
      question: "Face à un imprévu (ex : train annulé), je :",
      options: [
        { text: "Cherche immédiatement une solution concrète", style: "D" },
        { text: "Rassure les autres et reste calme", style: "S" },
        { text: "Propose une alternative tout en gardant le sourire", style: "I" },
        { text: "Consulte les règles ou options officielles disponibles", style: "C" }
      ]
    },
    {
      question: "Lorsque je dois convaincre quelqu’un :",
      options: [
        { text: "J’utilise des faits, des chiffres ou des exemples précis", style: "C" },
        { text: "Je m’adapte à l’autre en douceur", style: "S" },
        { text: "Je mise sur ma force de persuasion", style: "I" },
        { text: "Je vais droit au but en affirmant ma position", style: "D" }
      ]
    },
    {
      question: "En situation d’examen ou d’entretien, je suis plutôt :",
      options: [
        { text: "Préparé et rigoureux", style: "C" },
        { text: "Souriant et naturel", style: "I" },
        { text: "Posé et détendu", style: "S" },
        { text: "Concentré et compétitif", style: "D" }
      ]
    },
    {
      question: "Ce qui me dérange le plus au travail, c’est :",
      options: [
        { text: "Le désordre ou le manque de rigueur", style: "C" },
        { text: "Le manque d’échanges ou de bonne humeur", style: "I" },
        { text: "L’indécision ou l’inaction", style: "D" },
        { text: "Les conflits ou les ambiances tendues", style: "S" }
      ]
    },
    {
      question: "On me dit souvent que je suis :",
      options: [
        { text: "Exigeant mais juste", style: "D" },
        { text: "Drôle et sociable", style: "I" },
        { text: "Calme et fiable", style: "S" },
        { text: "Organisé et précis", style: "C" }
      ]
    }
  ];

  const container = document.getElementById('question-container');
  const validateBtn = document.getElementById('validateBtn');
  const contactForm = document.getElementById('contactForm');
  const confirmation = document.getElementById('confirmation');
  let responses = [];
  let currentIndex = 0;

  function showQuestion(index) {
    const q = questions[index];
    const block = document.createElement('div');
    block.className = 'question-block show';
    block.innerHTML = `<p><strong>${index + 1}. ${q.question}</strong></p>`;
    q.options.forEach((opt, i) => {
      block.innerHTML += `
        <label>
          <input type="radio" name="q${index}" value="${opt.style}" onchange="selectAnswer('${opt.style}', ${index})"> ${opt.text}
        </label>`;
    });
    container.appendChild(block);
  }

  function selectAnswer(style, index) {
    responses[index] = style;
    const block = container.children[index];
    block.classList.remove('show');
    block.classList.add('exit');

    if (index + 1 < questions.length) {
      setTimeout(() => showQuestion(index + 1), 500);
    } else {
      validateBtn.disabled = false;
    }
  }

  validateBtn.addEventListener('click', () => {
    contactForm.style.display = 'block';
    window.scrollTo(0, document.body.scrollHeight);
  });

  contactForm.addEventListener('submit', function(e) {
    e.preventDefault();
    const prenom = document.getElementById('prenom').value;
    const nom = document.getElementById('nom').value;
    const email = document.getElementById('email').value;

    const count = { D: 0, I: 0, S: 0, C: 0 };
    responses.forEach(r => count[r]++);
    const sorted = Object.entries(count).sort((a, b) => b[1] - a[1]);
    const profil = sorted[0][0] + (sorted[1][1] > 0 ? sorted[1][0] : "");

    fetch("http://127.0.0.1:5000/ajouter_contact", {
      method: "POST",
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ prenom, nom, email, profil })
    }).then(res => {
      contactForm.style.display = 'none';
      confirmation.style.display = 'block';
    }).catch(err => {
      alert("Erreur de connexion au serveur.");
    });
  });

  showQuestion(0);
</script>

</body>
</html>
